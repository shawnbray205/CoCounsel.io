<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoCounsel Legal Research Agent</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #1a202c;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
            font-size: 0.95rem;
        }

        .form-group textarea,
        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-group textarea:focus,
        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 640px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .btn {
            width: 100%;
            padding: 14px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 10px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .results-container {
            min-height: 400px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading p {
            color: #4a5568;
            font-size: 1rem;
        }

        .results {
            display: none;
        }

        .results.active {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .results-header h3 {
            color: #1a202c;
            font-size: 1.2rem;
        }

        .doc-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #48bb78;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            transition: background 0.2s ease;
        }

        .doc-link:hover {
            background: #38a169;
        }

        .results-content {
            line-height: 1.8;
            color: #2d3748;
        }

        .results-content h4 {
            color: #1a202c;
            margin-top: 24px;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .results-content p {
            margin-bottom: 16px;
        }

        .results-content strong {
            color: #1a202c;
        }

        .empty-state {
            display: block;
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state p {
            font-size: 1.1rem;
        }

        .error {
            display: none;
            padding: 16px;
            background: #fed7d7;
            border: 2px solid #fc8181;
            border-radius: 8px;
            color: #742a2a;
            margin-bottom: 20px;
        }

        .error.active {
            display: block;
        }

        .error strong {
            display: block;
            margin-bottom: 8px;
        }

        .examples {
            margin-top: 20px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .examples h3 {
            font-size: 1rem;
            margin-bottom: 12px;
            color: #2d3748;
        }

        .example-query {
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            color: #4a5568;
        }

        .example-query:hover {
            background: #edf2f7;
            transform: translateX(4px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öñÔ∏è CoCounsel</h1>
            <p>AI-Powered Legal Research Assistant</p>
        </div>

        <div class="main-content">
            <!-- Query Form -->
            <div class="card">
                <h2>Submit Legal Research Query</h2>
                
                <form id="researchForm">
                    <div class="form-group">
                        <label for="legalIssue">Legal Issue/Question *</label>
                        <textarea 
                            id="legalIssue" 
                            name="legalIssue" 
                            required
                            rows="3"
                            placeholder="What is the specific legal question? (e.g., 'Does my client have grounds to terminate the contract for material breach?')"
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <label for="facts">Relevant Facts *</label>
                        <textarea 
                            id="facts" 
                            name="facts" 
                            required
                            rows="6"
                            placeholder="Describe the key facts in chronological order. Include:
- Parties involved and their roles
- Important dates and timeline
- Specific actions taken or statements made
- Any relevant documentation or evidence
- Financial amounts or damages (if applicable)"
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <label for="outcome">Desired Outcome</label>
                        <textarea 
                            id="outcome" 
                            name="outcome" 
                            rows="2"
                            placeholder="What does the client want to achieve? (e.g., 'Terminate contract and recover damages', 'Suppress evidence', 'Seek injunction')"
                        ></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="jurisdiction">Jurisdiction *</label>
                            <select id="jurisdiction" name="jurisdiction" required>
                                <option value="">Select jurisdiction...</option>
                                <option value="federal">Federal</option>
                                <option value="Alabama">Alabama</option>
                                <option value="Alaska">Alaska</option>
                                <option value="Arizona">Arizona</option>
                                <option value="Arkansas">Arkansas</option>
                                <option value="California">California</option>
                                <option value="Colorado">Colorado</option>
                                <option value="Connecticut">Connecticut</option>
                                <option value="Delaware">Delaware</option>
                                <option value="Florida">Florida</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Hawaii">Hawaii</option>
                                <option value="Idaho">Idaho</option>
                                <option value="Illinois">Illinois</option>
                                <option value="Indiana">Indiana</option>
                                <option value="Iowa">Iowa</option>
                                <option value="Kansas">Kansas</option>
                                <option value="Kentucky">Kentucky</option>
                                <option value="Louisiana">Louisiana</option>
                                <option value="Maine">Maine</option>
                                <option value="Maryland">Maryland</option>
                                <option value="Massachusetts">Massachusetts</option>
                                <option value="Michigan">Michigan</option>
                                <option value="Minnesota">Minnesota</option>
                                <option value="Mississippi">Mississippi</option>
                                <option value="Missouri">Missouri</option>
                                <option value="Montana">Montana</option>
                                <option value="Nebraska">Nebraska</option>
                                <option value="Nevada">Nevada</option>
                                <option value="New Hampshire">New Hampshire</option>
                                <option value="New Jersey">New Jersey</option>
                                <option value="New Mexico">New Mexico</option>
                                <option value="New York">New York</option>
                                <option value="North Carolina">North Carolina</option>
                                <option value="North Dakota">North Dakota</option>
                                <option value="Ohio">Ohio</option>
                                <option value="Oklahoma">Oklahoma</option>
                                <option value="Oregon">Oregon</option>
                                <option value="Pennsylvania">Pennsylvania</option>
                                <option value="Rhode Island">Rhode Island</option>
                                <option value="South Carolina">South Carolina</option>
                                <option value="South Dakota">South Dakota</option>
                                <option value="Tennessee">Tennessee</option>
                                <option value="Texas">Texas</option>
                                <option value="Utah">Utah</option>
                                <option value="Vermont">Vermont</option>
                                <option value="Virginia">Virginia</option>
                                <option value="Washington">Washington</option>
                                <option value="West Virginia">West Virginia</option>
                                <option value="Wisconsin">Wisconsin</option>
                                <option value="Wyoming">Wyoming</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="practiceArea">Practice Area *</label>
                            <select id="practiceArea" name="practiceArea" required>
                                <option value="">Select practice area...</option>
                                <option value="general">General</option>
                                <option value="contract law">Contract Law</option>
                                <option value="employment law">Employment Law</option>
                                <option value="criminal law">Criminal Law</option>
                                <option value="intellectual property">Intellectual Property</option>
                                <option value="estate planning">Estate Planning</option>
                                <option value="family law">Family Law</option>
                                <option value="corporate law">Corporate Law</option>
                                <option value="real estate">Real Estate</option>
                                <option value="tax law">Tax Law</option>
                                <option value="bankruptcy">Bankruptcy</option>
                                <option value="immigration">Immigration</option>
                                <option value="environmental law">Environmental Law</option>
                                <option value="civil rights">Civil Rights</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn" id="submitBtn">
                        üîç Research Legal Issue
                    </button>
                </form>

                <div class="examples">
                    <h3>üìã Example Queries (Click to use)</h3>
                    <div class="example-query" 
                         data-issue="Does my client have grounds to terminate the contract for material breach and recover damages?"
                         data-facts="Client DataFlow Systems LLC entered into a software development contract with CodeCraft Inc. on January 15, 2025. Contract required delivery of CRM system with 5 specific features by April 15, 2025. Contract included 'Time is of the essence' clause. Client paid full $250,000 (50% upfront, 50% on March 1). As of October 1, 2025 (6 months past deadline), CodeCraft has only delivered 2 of 5 features. Client sent 47 emails and 12 formal breach notices. Client has suffered $180,000 in losses."
                         data-outcome="Terminate contract for material breach and recover damages including cost to complete with alternative vendor ($95,000)"
                         data-jurisdiction="California" 
                         data-practice="contract law">
                        Contract breach - software delivery failure
                    </div>
                    <div class="example-query" 
                         data-issue="Does my client have a viable age discrimination claim under ADEA?"
                         data-facts="Client Sarah Mitchell, 58-year-old senior marketing manager at TechCorp, terminated December 1, 2025 after 15 years with excellent reviews (most recent: 4.5/5.0 in November 2024). New VP (age 35) hired November 15, told client position being 'reorganized for cultural alignment with younger demographic.' Three days after termination, TechCorp posted identical position seeking 'digital natives' with 'fresh, youthful energy.' Hired replacement James Chen, age 32, with only 7 years experience vs. client's 15 years, at $15,000 less salary. HR stated company 'looking to refresh team with younger talent.'"
                         data-outcome="Pursue age discrimination claim under ADEA, seek reinstatement and/or damages"
                         data-jurisdiction="federal" 
                         data-practice="employment law">
                        Age discrimination in employment
                    </div>
                    <div class="example-query" 
                         data-issue="Can we suppress evidence obtained during warrantless search based on invalid exigent circumstances?"
                         data-facts="Client Marcus Johnson arrested November 10, 2025 at 10:30 PM. Police responded to neighbor complaint of 'suspicious activity' and marijuana smell. Officers entered apartment without warrant claiming exigent circumstances based on marijuana odor. Found 2.5 grams marijuana, $3,200 cash, and scale. Key facts: (1) NY legalized recreational marijuana up to 3 oz in 2021, (2) No signs of ongoing crime or evidence destruction, (3) 'Loud voices' were just dinner party conversation, (4) Neighbor has history of 6 unsubstantiated complaints against client."
                         data-outcome="File motion to suppress all evidence; seek dismissal of possession with intent to distribute charges"
                         data-jurisdiction="New York" 
                         data-practice="criminal law">
                        Fourth Amendment - warrantless search
                    </div>
                </div>
            </div>

            <!-- Results Display -->
            <div class="card results-container">
                <div class="empty-state" id="emptyState">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <p>Submit a query to see research results</p>
                </div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Conducting legal research...</p>
                    <p style="font-size: 0.9rem; margin-top: 10px; color: #718096;">This may take 30-60 seconds</p>
                </div>

                <div class="error" id="error">
                    <strong>‚ö†Ô∏è Error</strong>
                    <p id="errorMessage"></p>
                </div>

                <div class="results" id="results">
                    <div class="results-header">
                        <h3>Research Results</h3>
                        <a href="#" id="docLink" class="doc-link" target="_blank" style="display: none;">
                            üìÑ View Full Document
                        </a>
                    </div>
                    <div class="results-content" id="resultsContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration - n8n webhook URL for CoCounsel Legal Research Agent
        const WEBHOOK_URL = 'https://sbray205.app.n8n.cloud/webhook/b17dff75-6a3d-4cd3-a03e-7432e0718b05';

        const form = document.getElementById('researchForm');
        const submitBtn = document.getElementById('submitBtn');
        const emptyState = document.getElementById('emptyState');
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const errorMessage = document.getElementById('errorMessage');
        const results = document.getElementById('results');
        const resultsContent = document.getElementById('resultsContent');
        const docLink = document.getElementById('docLink');

        // Example queries click handlers
        document.querySelectorAll('.example-query').forEach(example => {
            example.addEventListener('click', () => {
                document.getElementById('legalIssue').value = example.dataset.issue || '';
                document.getElementById('facts').value = example.dataset.facts || '';
                document.getElementById('outcome').value = example.dataset.outcome || '';
                document.getElementById('jurisdiction').value = example.dataset.jurisdiction;
                document.getElementById('practiceArea').value = example.dataset.practice;
            });
        });

        // Form submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Hide all states
            emptyState.style.display = 'none';
            error.classList.remove('active');
            results.classList.remove('active');
            loading.classList.add('active');
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ Researching...';

            // Get form data and construct comprehensive query
            const legalIssue = document.getElementById('legalIssue').value;
            const facts = document.getElementById('facts').value;
            const outcome = document.getElementById('outcome').value;
            const jurisdiction = document.getElementById('jurisdiction').value;
            const practiceArea = document.getElementById('practiceArea').value;

            // Construct a comprehensive query
            const comprehensiveQuery = `LEGAL ISSUE:
${legalIssue}

RELEVANT FACTS:
${facts}

${outcome ? `DESIRED OUTCOME:\n${outcome}\n\n` : ''}JURISDICTION: ${jurisdiction}

PRACTICE AREA: ${practiceArea}

Please provide a comprehensive legal memorandum analyzing this situation, including relevant case law, statutes, and practical recommendations.`;

            const formData = {
                query: comprehensiveQuery,
                jurisdiction: jurisdiction,
                practiceArea: practiceArea
            };

            try {
                // Call n8n webhook
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Display results
                loading.classList.remove('active');
                results.classList.add('active');

                // Format and display the memo content
                if (data.memo) {
                    resultsContent.innerHTML = formatMemo(data.memo);
                } else if (data.content) {
                    resultsContent.innerHTML = formatMemo(data.content);
                } else {
                    resultsContent.innerHTML = '<p>Research completed, but no formatted results available.</p>';
                }

                // Add document link if available
                if (data.documentUrl) {
                    docLink.href = data.documentUrl;
                    docLink.style.display = 'inline-flex';
                }

            } catch (err) {
                console.error('Error:', err);
                loading.classList.remove('active');
                error.classList.add('active');
                errorMessage.textContent = `Failed to complete research: ${err.message}. Please check your connection and try again.`;
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'üîç Research Legal Issue';
            }
        });

        // Format memo text for display
        function formatMemo(text) {
            // Convert newlines to paragraphs
            let formatted = text
                .split('\n\n')
                .map(para => {
                    para = para.trim();
                    if (!para) return '';
                    
                    // Check if it's a heading (ALL CAPS or starts with ##)
                    if (para === para.toUpperCase() && para.length < 100) {
                        return `<h4>${escapeHtml(para)}</h4>`;
                    }
                    
                    return `<p>${escapeHtml(para).replace(/\n/g, '<br>')}</p>`;
                })
                .join('');

            return formatted || '<p>No content available</p>';
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
